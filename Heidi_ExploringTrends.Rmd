---
title: "Heidi_ExploringTrends"
author: "Heidi Erfourth and Zoe Schroder"
date: "2023-07-25"
output: html_document
---

“Exploring trends in tornado outbreak environments and greenhouse gas concentrations” 

`Pursue publication:` International Journal of Climatology
                      https://mc.manuscriptcentral.com/joc 

**Make sure to follow the Author Resources for publication in the Journal. This includes page formatting, section headers, figure format, table format, figure/table location in manuscript, etc.**

```{r}
# Do not need to do these everytime. Once installed on your computer you are finished. 
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("tidyverse")
#install.packages("tmap")
#install.packages("devtools")
#devtools::install_github("ropensci/USAboundaries")
#devtools::install_github("ropensci/USAboundariesData")
install.packages("gridExtra")
```

```{r}
library("dplyr")
library("ggplot2")
library("tmap")
library("USAboundaries")
library("sf")
library("gridExtra")
#library("gridExtra")
```

creating general trend and regression charts 
```{r}
AnnGHG <- read.csv("AnnualAverages_GHG.csv")
dim(AnnGHG)
str(AnnGHG)
```

CO2 Trend Analysis Chart
```{r}  
ggplot(AnnGHG, aes(x=year, y=CO2_ppm))+
  geom_bar(stat="identity",position = "stack",  fill="orange", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="black",linewidth=1.5)+
  ggtitle(bquote("Annual Average of Carbon Dioxide CO"[2]))+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Year")+
  ylab("Concenration (ppm)")+
  scale_x_continuous(expand=c(0,0), limits=c(1955,2025), breaks=c(seq(1960,2025,10)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,500), breaks=c(seq(0,500,50)))
```

CH4 Trend Analysis Chart
```{r}  
ggplot(AnnGHG, aes(x=year, y=CH4_ppb))+
  geom_bar(stat="identity",position="stack",  fill="pink", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom="smooth", color="black", linewidth=1.5)+
  ggtitle(bquote("Annual Average of Methane CH"[4]))+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Years Recorded")+
  ylab("CH4 (ppb)")+
  scale_x_continuous(expand=c(0,0), limits=c(1980,2025), breaks=c(seq(1980, 2025, 10)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,2000), breaks=c(seq(0,2000,100)))
```

*Here is the code to rename a column in R: * Fixing the typo in the excel file zero to O
```{r}
colnames(AnnGHG)[colnames(AnnGHG) == "N20_ppb"] = "N2O_ppb"
```

N2O Trend Analysis Chart
```{r}
ggplot(AnnGHG, aes(x=year, y=N20_ppb))+
  geom_bar(stat="identity",position = "stack",  fill="forestgreen", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="black", linewidth=1.5)+
  ggtitle(bquote("Annual Average of Nitrous Oxide N[2]O"))+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Years Recorded")+
  ylab("N2O (ppb)")+
  scale_x_continuous(expand=c(0,0), limits=c(2000,2025), breaks=c(seq(2000, 2025, 4)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,400), breaks=c(seq(0,400,25)))
``` 

SF6 Trend Analysis Chart
```{r}
ggplot(AnnGHG, aes(x=year, y=SF6_ppt))+
  geom_bar(stat="identity",position = "stack", fill="purple", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="black", linewidth=1.5)+
  ggtitle(bquote("Annual Average of Sulfur Hexfloride SF"[6]))+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Years Recorded")+
  ylab("SF6 (ppt)")+
  scale_x_continuous(expand=c(0,0), limits=c(1995,2025), breaks=c(seq(1995, 2025, 4)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,15), breaks=c(seq(0,15,1)))
```

O3 Trend Analysis Chart  
```{r}
#DU = Dobson Units
ggplot(AnnGHG, aes(x=year, y=O3_DU))+
  geom_bar(stat="identity",position = "stack",  fill="maroon", width=0.9)+
  stat_smooth(method = "lm", formula= y~x, geom = "smooth", color="black", linewidth=1.5)+
  ggtitle(bquote("Annual Average of Ozone O"[3]))+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Years Recorded")+
  ylab("03 (DU)")+
  scale_x_continuous(expand=c(0,0), limits=c(1975,2025), breaks=c(seq(1975, 2025, 4)))+
  scale_y_continuous(expand=c(0,0), limits=c(0, 250), breaks=c(seq(0,250, 25)))
```

AGGI Trend Analysis Chart
```{r}
ggplot(AnnGHG, aes(x=year, y=AGGI))+
  geom_bar(stat="identity",position = "stack",  fill="blue", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom="smooth", color="black", linewidth=1.5)+
  ggtitle("Annual Average for Annual Greenhouse Gas Index (AGGI)")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Years Recorded")+
  ylab("AGGI")+
  scale_x_continuous(expand=c(0,0), limits=c(1975,2025), breaks=c(seq(1975, 2025, 4)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,2), breaks=c(seq(0,2,0.1)))

```
Findings given regression lines:
  -> CO2, CH4, N2O, SF6, AGGI  increases as years go on
  -> O3 decreases as years go on but has more variation throughout the years. 
  
Combined annual  averages
```{r}
CO2_avg <- qplot(year, CO2_ppm, data = AnnGHG)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="darkturquoise", linewidth=1.5)+
  theme_bw()+
  ylab("Average of CO2")
CH4_avg <- qplot(year, CH4_ppb, data = AnnGHG)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="plum3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of CH4")
N2O_avg <- qplot(year, N2O_ppb, data=AnnGHG)+
  stat_smooth(method ="lm", formula = y~x, geom = "smooth", color="goldenrod3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of N2O")
SF6_avg <- qplot(year, SF6_ppt, data=AnnGHG)+
  stat_smooth(method = "lm", formula = y~x, geom="smooth", color="forestgreen", linewidth=1.5)+
  theme_bw()+
  ylab("Average of SF6")
O3_avg <-  qplot(Year, O3_DU, data = AnnGHG)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="pink3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of O3")
AGGI_avg<- qplot(Year, AGGI_1year, data= BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="seagreen3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of AGGI")

grid.arrange(CO2_avg, CH4_avg,N2O_avg,SF6_avg,O3_avg, AGGI_avg, nrow=2,ncol=3, top ="Annual Averages of Greenhouse Gases")


```


*The 10 year averages are already calculated for you. They are in the BigDays.sfdfT file found in the TornadoOutbreaks.RData*

```{r}
load("TornadoOutbreaks.RData")

#str(BigDays.sfdfT)

#Example: 
#BigDays.sfdfT$CH4_10year
dim(BigDays.sfdfT)


```
NOTE: These are only for the years 1994 to 2022. Moving forward, you will only use CO2, CH4, O3, and AGGI. N2O and SF6 are excluded because the data does not extend back to 1994. 

**The avg for 1994 is 1984 - 1994 not inclusive. Meaning it includes the data for years January 1984 through December 1993.**

Grouping CO2 10 averages
```{r}
#First: Get the 10-year average value for each year 1994 - 2022

#CO2 10 year averages
CO2 <- BigDays.sfdfT[,-80] %>%
  group_by(Year) %>%
  summarize(CO2_10yr = max(CO2_10year))

```

CO2 10-year averages trend
```{r}
#Second: Make the plot!
ggplot(CO2) +
  geom_line(aes(x = Year, y = CO2_10yr), 
            color = "red",
            linewidth = 1)  +
  theme_bw() +
  xlab("Year") +
  ylab(expression(paste("10-year Average ",CO^2," Emissions [ppm]"))) +
  theme(axis.text = element_text(size = 12), 
        axis.text.x = element_text(angle = 45, 
                                   vjust = 1.2, 
                                   hjust = 1.2),
        axis.title = element_text(size = 14), 
        legend.text = element_text(size = 14),
        ) +
  scale_x_continuous(expand = c(0, 0), 
                     limits=c(1994, 2022), 
                     breaks = seq(1994, 2022, 2)) + 
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(345, 415), 
                     breaks = seq(350, 415, 10)) 
```

Grouping CH4 10 year averages
```{r}
CH4 <- BigDays.sfdfT[,-80]%>%
  group_by(Year) %>%
  summarize(CH4_10yr = max(CH4_10year))

```

CH4 10 year averages trend
```{r}
ggplot(CH4)+
  geom_line(aes(x=Year, y= CH4_10yr), color="midnightblue",linewidth=1 )+
  theme_bw()+
  xlab("Year")+
  ylab("10-Year average CH4 Emissions [ppb]")+
  scale_x_continuous(expand=c(0,0), limits=c(1994, 2022), breaks=seq(1994,2022,2))+
  scale_y_continuous(expand=c(0,0), limits=c(1720,1880), breaks=seq(1720,1880, 20))

```

Grouping O3 10 year averages
```{r}
O3 <- BigDays.sfdfT[,-80] %>%
  group_by(Year) %>%
  summarize(O3_10yr=max(O3_10year))

```

O3 10-year averages trend
```{r}
ggplot(O3)+
  geom_line(aes(x=Year, y= O3_10yr), color="lemonchiffon4",linewidth=1 )+
  theme_bw()+
  xlab("Year")+
  ylab("10-Year average O3 Emissions [DU]")+
  scale_x_continuous(expand=c(0,0), limits=c(1994, 2022), breaks=seq(1994,2022,2))+
  scale_y_continuous(expand=c(0,0), limits=c(90,150), breaks=seq(90,150, 20))
  
```

Grouping AGGI 10 year averages
```{r}
AGGI <- BigDays.sfdfT[,-80]%>%
  group_by(Year) %>%
  summarize(AGGI_10yr=max(AGGI_10year))
```

AGGI 10-year averages trend
```{r}
ggplot(AGGI)+
  geom_line(aes(x=Year, y= AGGI_10yr), color="goldenrod1",linewidth=1 )+
  ggtitle("Ten year Average of \n Annual Greenhouse Gas Index (AGGI)")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Year")+
  ylab("10-Year average AGGI Emissions")+
  scale_x_continuous(expand=c(0,0), limits=c(1994, 2022), breaks=seq(1994,2022,2))+
  scale_y_continuous(expand=c(0,0), limits=c(0.5,2), breaks=seq(0.5,2,0.1))
  
```

4x4 Plot of GHG Avg/year
```{r}
CO2_avg <- qplot(Year, CO2_1year, data = BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="darkturquoise", linewidth=1.5)+
  theme_bw()+
  ylab("Average of CO2")
CH4_avg <- qplot(Year, CH4_1year, data = BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="plum3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of CH4")
O3_avg <-  qplot(Year, O3_1year, data = BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="pink3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of O3")
AGGI_avg<- qplot(Year, AGGI_1year, data= BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="seagreen3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of AGGI")

grid.arrange(CO2_avg, CH4_avg, O3_avg, AGGI_avg, nrow=2,ncol=2, top ="Annual Averages of Greenhouse Gases")


```


Cluster: >= 10 tornadoes 
```{r}
BigDays.sfdfT[,-80]%>%
  group_by(cDate)%>%
  filter(nT>=10)

```

Total Outbreaks per year
```{r}
T_yr<-BigDays.sfdfT[,-80]%>%
  group_by(cDate)%>%
  group_by(Year)%>%
  summarize(T_Year = n())
  
```
 
Outbreaks per year trend analysis
```{r}
ggplot(T_yr)+
  geom_line(aes(x=Year, y=T_Year), color="plum3", linewidth=1)+
  ggtitle("Total Tornado Outbreaks Per Year")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Year")+
  ylab("Number of Tornado Outbreaks per Year")+
  scale_x_continuous(expand = c(0,0),limits=c(1994,2022), breaks=seq(1994,2022,2))+
  scale_y_continuous(expand = c(0,0),limits=c(20,50),  breaks=seq(20,50,5))

```
 
Spatial Distribution of T-Outbreaks in the US
```{r}
sts <- state.name[!state.name %in% c("Alaska", "Hawaii")] #Removes AK and HI from list of states
stateBorders <- us_states(states = sts)

library(sf)

sp::coordinates(BigDays.sfdfT) <- ~ sLon + sLat
BigDays.sf.dfT <- st_as_sf(BigDays.sfdfT)

```


