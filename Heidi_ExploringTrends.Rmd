---
`title: "Heidi_ExploringTrends"
author: "Heidi Erfourth and Zoe Schroder"
date: "2023-07-25"
output: html_document
editor_options: 
  chunk_output_type: console
---

“Exploring trends in tornado outbreak environments and greenhouse gas concentrations” 

`Pursue publication:` International Journal of Climatology
                      https://mc.manuscriptcentral.com/joc 

**Make sure to follow the Author Resources for publication in the Journal. This includes page formatting, section headers, figure format, table format, figure/table location in manuscript, etc.**

```{r}
suppressMessages(library("dplyr"))
suppressMessages(library("ggplot2"))
suppressMessages(library("tmap"))
suppressMessages(library("USAboundaries"))
suppressMessages(library("sf"))
suppressMessages(library("gridExtra"))
suppressMessages(library("RColorBrewer"))
suppressMessages(library("corrplot"))
```

DATA & METHODS
```{r}
load("TornadoOutbreaks.RData")
AnnGHG <- read.csv("AnnualAverages_GHG.csv")
```

*State Boarders for Contiguous United States (WILL BE USED SEVERAL TIMES THROUGHOUT PROJECT)*
```{r}
sts <- state.name[!state.name %in% c("Alaska", "Hawaii")] #Removes AK and HI from list of states
stateBorders <- us_states(states = sts) 
```

**Map Projections (WILL BE USED SEVERAL TIMES THROUGHOUT PROJECT)**
```{r}
merc <- "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"

US_LCC <- "+proj=lcc +lat_1=33 +lat_2=45 +lat_0=39 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m no_defs"
```

#Adjusting Platte Hues
```{r}
cr <- RColorBrewer::brewer.pal(9, "Reds")
cr <- cr[-c(1:3)]
cas<- RColorBrewer::brewer.pal(9,"Blues")
cas<- cas[-c(1:3)]
```

########################
## SPC Tornado Data ##
########################

**Tornadoes for 2008**
```{r}
#Pulling Tornado Data only for 2008
OK2008<-All_Tornadoes%>%
  dplyr::filter(st=="OK")

#filter state borders for only Oklahoma
OKL<-stateBorders%>%
  dplyr::filter(state_abbr=="OK")
```

**Plotting 2008 Oklahoma Outbreak Data**
```{r}
#Creating Map Projection
tm_shape(OKL)+
  
  #Formatting Borders
  tm_borders(col ="gray", 
             alpha = 1)+
  
  #Compass and Scale Bar Formatting
  tm_compass(text.size = 0.5, 
             lwd = 2, 
             color.dark = "gray",
             position = c(0.9,0.1))+
  tm_scale_bar(width = 0.2, 
               text.size = 1, 
               lwd = 2,  
               color.dark = "gray",
               position = c(0.68,0.01))+
  
  #Formatting Plot 
  tm_layout(attr.position=c("right","bottom"), 
            inner.margins = c(0.3,0.2,0.3,0.2), 
            title="2008 Oklahoma Tornadoes", 
            title.position = c(0.30, 0.95))+
  
#Plotting Individual Tornadoes
tm_shape(OK2008,
         projection = merc)+
  
  #Formatting Tornado Bubbles
   tm_bubbles(size = 0.04,
             border.lwd=NA, 
             palette = cr,
             col="mag",
             breaks=seq(0,6,by=1),
             labels=c("F0", "F1","F2", "F3", "F4", "F5"),
             title.col="Magntiude")
```

########################
## Mutli. Clus. Day  ##
########################

**Finding a Single Day with Multiple Clusters **
```{r}
MultiClus<-BigDays.sfdfT %>% # Cluster Data
  group_by(cDate)%>% # Group by the c. days to see if there are duplicates
  summarize(num_of_clusters = n())%>%  # Count the number of clusters on each cDate.
  arrange(desc(num_of_clusters)) # Arrange the number of clusters column in descending order.
```

**Data from June 4, 1999 Outbreak**
```{r}
#Group Number: 1686, 1688
#Cluster 1 Data
June4<-BigDays.sfdfT%>%
  dplyr::filter(ID=="199906041686")

June4cent <-BigDayCentroids.df %>%
  dplyr::filter(ID=="199906041686")

June4Torns <- BigDayTornadoes%>%
  dplyr::filter(ID=="199906041686")

#Cluster 2 Data
June4_1<-BigDays.sfdfT%>%
  dplyr::filter(ID=="199906041688")

June4_1cent <-BigDayCentroids.df %>%
  dplyr::filter(ID=="199906041688")

June4_1Torns <- BigDayTornadoes%>%
  dplyr::filter(ID=="199906041688")

#Combining Cluster Data
June <- rbind(June4, June4_1)#Overall Data 
Junecent <- rbind(June4cent, June4_1cent)#Centroids
JuneTorns <- rbind(June4Torns, June4_1Torns)#Tornadoes
```

**Plotting June 4, 1999 Outbreak Data (Convective Day: 6 am 27th to 6 am 28th)**
```{r}
#Creating Map Projection
tm_shape(stateBorders,
          projection = merc)+
  
  #Formatting Borders
  tm_borders(col ="gray", 
             alpha = 1)+
  
  #Compass and Scale Bar Formatting
  tm_compass(text.size = 0.5, 
             lwd = 2, 
             color.dark = "gray",
             position = c(0.9,0.1))+
  tm_scale_bar(width = 0.2, 
               text.size = 1, 
               lwd = 2,  
               color.dark = "gray",
               position =c(0.68,0.01))+
  
  #Formatting Plot 
  tm_layout(legend.position = c(0.01,0),
            legend.text.size = 0.9,
            legend.title.size = 1.2,
            attr.position=c("right","bottom"), 
            inner.margins = c(0.3,0.2,0.3,0.2), 
            title="June 4, 1999", 
            title.position = c(0.40, 0.95))+
  
#Creating Polygons for Clusters
tm_shape(June, 
         is.master = TRUE, 
         projection = merc)+
  
  #Formatting Polygons
  tm_polygons(alpha = 0, 
              border.col = "black", 
              lwd = 1.5)+

#Plotting Individual Tornadoes
tm_shape(JuneTorns, 
         projection = merc )+
  
  #Formatting Tornado Bubbles
  tm_bubbles(size = 0.3,
             border.lwd=NA, 
             palette = cr, 
             col="mag",
             breaks=seq(0,6,by=1),
             labels=c("F0", "F1","F2", "F3", "F4", "F5"),
             title.col="Magntiude")+
  
  
#Plotting Centroids
tm_shape(Junecent,
         is.master=TRUE,
         projection = merc)+
  
  #Formatting Centroids
  tm_symbols(size = 1.25, 
             col="black", 
             shape=24)
```

#########################
## Big Days Example  ##
#########################

**Redoing plot to new method in upadted file***
```{r}
BG<-BigDays.sfdfT%>%
  dplyr::filter(ID=="202112156918")

BGcent <-BigDayCentroids.df%>%
  dplyr::filter(ID=="202112156918")

BGTorns <- BigDayTornadoes%>%
  dplyr::filter(ID=="202112156918") 

```

```{r}
tm_shape(stateBorders, 
         projection = merc) +
  tm_borders(col ="gray70", 
             alpha = 1) +
  tm_compass(text.size = 1.25, size = 3,
             lwd = 2, 
             color.dark = "gray70") +
  tm_scale_bar(width = .25, 
               text.size = 1.25, 
               lwd = 1.75,  
               color.dark = "gray70") +
  tm_layout(attr.position = c("right","bottom"), 
            inner.margins = c(.15, .15, .15, .15)) +
tm_shape(BG, 
         is.master = TRUE, 
         projection = merc) + 
  tm_polygons(alpha = 0, 
              border.col = "black", 
              lwd = 1.5) +
tm_shape(BGTorns,
         projection = merc) +
  tm_bubbles(alpha = 0.7,
             size = 0.8, 
             col="mag", 
             breaks = seq(0,3,by=1),
             border.alpha = 0,
             palette = cr,
             labels = c("F0", "F1","F2"),
             title.col="Magnitude")+
  tm_layout(title= "December 15, 2021\n    125 tornadoes", 
            title.position = c("center", "top"), 
            title.size = 1.75,
            legend.show = TRUE,
            legend.position = c("left", "bottom"), 
            legend.height = 2,
            legend.text.size = 1.25, 
            legend.title.size = 1.5,) +
tm_shape(BGcent,
         is.master=TRUE,
         projection = merc) +
  tm_symbols(size = 1.25, 
             col="black", 
             shape=24)
  
```


#########################
## Out. County Density ##
#########################

**getting county data**
```{r}
counties.sf <- us_counties()

#Set the coordinate reference system:
counties.sf <- st_transform(counties.sf, 
                            crs = st_crs(BigDays.sfdfT))
```

**counting amount of times each outbreak crosses/interesects a county in Contiguous United States**
```{r}
gI <- st_intersects(BigDays.sfdfT, counties.sf, sparse = FALSE)
colnames(gI) <- counties.sf$name
counties.sf$GroupDayCount <- colSums(gI)
```

**creating map of outbreak density in each U.S.county. Fill by the `GroupDayCount` column.**
```{r}
counties.sf <- st_transform(counties.sf, 
                            crs = st_crs(stateBorders))
BigDays.sfdfT <- st_transform(BigDays.sfdfT, 
                            crs = st_crs(stateBorders))
#Plotting Data
tm_shape(BigDays.sfdfT) +
  tm_polygons(alpha = 0, 
              border.alpha = 0) +
  
#Plotting Counties
tm_shape(counties.sf) +
   tm_fill("GroupDayCount",
           title = "Total Outbreaks",
           palette = "Reds", 
           breaks = c(0, 20, 40, 60, 80, 100, 120)) +
  
  #Formatting County Boarders
  tm_borders(col = "gray", 
             alpha = .3) +
  
  #Adding Compass and Scale
  tm_compass(size = 1.5, 
             position = c(0,0.2)) + 
  
  tm_scale_bar(width = 0.3, 
               text.size = 1, 
               position = c(0.01,0)) +
  
  #Formatting overall figure and adding a legend
  tm_layout(legend.position = c(0.85, 0.0),
            attr.position = c("left", "bottom"),
            legend.frame = FALSE,
            title = "Tornado Outbreaks by County 1994-2022",
            title.size = 1.5,
            title.position = c(0.05,0.95),
            inner.margins = c(.15, .01, .01, .01),
            legend.width = -0.3, 
            legend.height = -0.4, 
            legend.title.size= 1.5,
            legend.text.size = 1.25,
            legend.bg.alpha =1) +
  
#plotting state boarders  
tm_shape(stateBorders, 
         is.master = TRUE,
         projection = merc) +
  
  tm_borders() 
```

#########################
## Total Outbreaks  ##
#########################

Plotting Outbreaks for 1994-2022
```{r}
#Creating Map Projection
tm_shape(stateBorders,
         projection = merc)+
  
  #Formatting Plot
  tm_borders(col ="gray", 
             alpha = 1)+
  tm_layout(title="Tornado Outbreaks from 1994-2022",
            title.position = c(0.3, 0.95),
            inner.margins = c(0.1,0.1,0.1,0.1))+
  
  #Formatting Compass & Scale Bar
  tm_compass(text.size = 0.5, 
             lwd = 2, 
             color.dark = "gray",
             position = c(0.9,0.2))+
  tm_scale_bar(width = 0.3, 
               text.size = 5,
               lwd = 2, 
               color.dark = "gray", 
               position = c(0.65,0))+
  
#Plotting Individual Clusters Using Centroids
tm_shape(BigDayCentroids.df, 
         projection = merc )+

  
  #Formatting Centroids
  tm_bubbles(size = 0.1,
             border.lwd=NA, 
             col= "GroupDayCas",
             palette= cas)+
  tm_layout(legend.position = c(0.01,0),
            legend.title.size = 0.8,
            legend.text.size = 0.7)
  
``` 

##################
## GHG GML Data ##
##################

CO2 Annual Average
```{r}
#Plotting CO2 1 Year Averages 
CO2_GML<- ggplot(AnnGHG, 
                  aes(x= year, y=CO2_ppm))+

  #Line Graph
   geom_line(stat="identity", 
             color = "dodgerblue3",
             linewidth = 1)+
  
  #Formatting Plot
   theme_bw()+
   theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Foratting Axes
   ylab(expression("CO"[2]* "(ppm)"))+
   scale_x_continuous(expand = c(0, 0), 
                     limits=c(1994, 2022), 
                     breaks = seq(1994, 2022,4)) + 
   scale_y_continuous(expand = c(0,0), 
                     limits=c(350, 415), 
                     breaks = seq(350, 415, 10)) 
```

CH4 Annual Average
```{r}
#Plotting CH4 Data
CH4_GML<-ggplot(AnnGHG, 
                  aes(x=year, y = CH4_ppb))+
 
  #Line Graph
   geom_line(stat="identity",
             color = "purple3",
             linewidth = 1)+
  
  #Formatting Plot
   theme_bw()+
   theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
   ylab(expression("CH"[4]* "(ppb)"))+
   scale_x_continuous(expand=c(0,0), 
                      limits=c(1994, 2022), 
                      breaks=seq(1994,2022,4))+
   scale_y_continuous(expand=c(0,0), 
                      limits=c(1740,1880), 
                      breaks=seq(1720,1880, 20))
```

O3 Annual Average
```{r}
#Plotting O3 Data
O3_GML<-ggplot(AnnGHG,
               aes(x=year, y=O3_DU))+

  #Line Graph
   geom_line(stat="identity",
             color = "goldenrod3",
             linewidth = 1)+
  
  #Formatting Plot
   theme_bw()+
   theme(axis.text.x=element_text(angle=45, hjust = 1))+
  
  #Formatting axes
   ylab(expression("O"[3]* "(DU)"))+
   scale_x_continuous(expand=c(0,0), 
                      limits=c(1994, 2022), 
                      breaks=seq(1994,2022,4))+
   scale_y_continuous(expand=c(0,0), 
                      limits=c(90,175), 
                      breaks=seq(90,175, 20))
```

AGGI Annual Average
```{r}
#Plotting AGGI Data
AGGI_GML<- ggplot(AnnGHG,
                  aes(x=year, y=AGGI))+
  
  #Line Graph
   geom_line(stat="identity", 
             color = "green4",
             linewidth = 1)+
  
  #Formatting plot
   theme_bw()+
   theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
   ylab("AGGI")+
   xlab("Year")+
   scale_x_continuous(expand=c(0,0), 
                      limits=c(1994, 2022), 
                      breaks=seq(1994,2022,4))+
   scale_y_continuous(expand=c(0,0), 
                      limits=c(0.5,2),
                      breaks=seq(0.5,2,0.2))
```

4x4 Grid Annual Averages
```{r}
grid.arrange(CO2_GML, CH4_GML, O3_GML, AGGI_GML, nrow=2,ncol=2, top ="Annual Averages of Greenhouse Gas Emissions from GML")
```


RESULTS

###########################
## Annual Change in Out. ##
###########################

Grouping Total Number of Outbreaks per Year
```{r}
Totout_yr <- BigDays.sfdfT%>% 
  group_by(Year)%>%
  summarize(Totout_Year = n())

```

Graphing Total Outbreaks per Year
```{r}
#Plotting Outbreaks
ggplot(Totout_yr,
       aes(x=Year, y=Totout_Year))+
  
  #Line Graph
  geom_line(stat="identity", 
            color="orange3", 
            linewidth=1)+
  
  #Creating Linear Regression Line
  stat_smooth(method = "lm", 
              formula = y~x, 
              geom="smooth", 
              color="black", 
              linewidth=1)+
  
  #Plot Formatting
  ggtitle("Total Tornado Outbreaks Per Year")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5), 
        plot.margin=margin(0.5,0.5,0.5,0.5, "cm"), 
        axis.text.x=element_text(angle=45, hjust=1))+
  
  #Axes Formatting
  xlab("Year")+
  ylab("Number of Tornado Outbreaks per Year")+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022),
                     breaks=seq(1994,2022,2))+
  scale_y_continuous(expand = c(0,0),
                     limits=c(20,50), 
                     breaks=seq(20,50,5))
```

###########################
## Monthly  Change in Out. ##
###########################

Grouping Total Number of Outbreaks per Year
```{r}
Totout_mon <- BigDays.sfdfT%>% 
  group_by(Month)%>%
  summarize(Totout_Monthly = n())

DJF<-sum(Totout_mon$Totout_Monthly[12],Totout_mon$Totout_Monthly[1],Totout_mon$Totout_Monthly[2])
MAM<-sum(Totout_mon$Totout_Monthly[3],Totout_mon$Totout_Monthly[4],Totout_mon$Totout_Monthly[5])
JJA<-sum(Totout_mon$Totout_Monthly[6],Totout_mon$Totout_Monthly[7],Totout_mon$Totout_Monthly[8])
SON<-sum(Totout_mon$Totout_Monthly[9],Totout_mon$Totout_Monthly[10],Totout_mon$Totout_Monthly[11])
Seasons <- data.frame(seasons =c("DJF", "MAM", "JJA","SON"))
Seasons$Total_Clusters<- c(DJF, MAM, JJA, SON)

Seasons
```

Graphing Total Outbreaks per Year
```{r}
#Plotting Outbreaks
ggplot(Seasons,
       aes(x=seasons, y=Total_Clusters))+
  
  #Line Graph
  geom_bar(stat="identity", 
            fill="red3", 
            linewidth=1)+
  
  #Creating Linear Regression Line
  stat_smooth(method = "lm", 
              formula = y~x, 
              geom="smooth", 
              color="black", 
              linewidth=1)+
  
  #Plot Formatting
  ggtitle("Total Clusters Per Season")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5), 
        plot.margin=margin(0.5,0.5,0.5,0.5, "cm"), 
        axis.text.x=element_text(angle=45, hjust=1))+
  
  #Axes Formatting
  xlab("Season")+
  ylab("Total Clusters")+
  #scale_x_continuous(expand = c(0,0),
                  #   limits=c(1,12),
                   #  breaks=seq(1,12,1))+
  scale_y_continuous(expand = c(0,0),
                     limits=c(0,500), 
                     breaks=seq(0,500,50))
```
`FIG_ClusbySeason`

###############################
## Annual Change in Out. Cas.##
###############################

Grouping Total Number of Outbreaks per Year
```{r}
TotCas_yr <- BigDays.sfdfT%>% 
  group_by(Year)%>%
  summarize(TotalCas_yr = sum(GroupDayCas))
```

Graphing Total Outbreak Casualties per Year
```{r}
#Plotting Outbreaks
ggplot(TotCas_yr,
       aes(x=Year, y=TotalCas_yr))+
  
  #Line Graph
  geom_line(stat="identity", 
            color="deeppink3", 
            linewidth=1)+
  
  #Creating Linear Regression Line
  stat_smooth(method = "lm", 
              formula = y~x, 
              geom="smooth", 
              color="black", 
              linewidth=1)+
  
  #Plot Formatting
  ggtitle("Total Tornado Outbreak Casualties Per Year")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5), 
        plot.margin=margin(0.5,0.5,0.5,0.5, "cm"), 
        axis.text.x=element_text(angle=45, hjust=1))+
  
  #Axes Formatting
  xlab("Year")+
  ylab("Number of Tornado Outbreak Casualties per Year")+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022),
                     breaks=seq(1994,2022,2))+
  scale_y_continuous(expand = c(0,0),
                     limits=c(100,6000), 
                     breaks=seq(100,6000,500))
```

###########################
## Annual Change in GHG ##
###########################

CO2 Annual Average
```{r}
#Plotting CO2 1 Year Averages 
CO2_avg <- ggplot(BigDays.sfdfT, 
                  aes(x= Year, y=CO2_1year))+

  #Line Graph
   geom_line(stat="identity", 
             color = "dodgerblue3",
             linewidth = 1)+
  
  #Formatting Plot
   theme_bw()+
   theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Foratting Axes
   ylab(expression("CO"[2]* "(ppm)"))+
   scale_x_continuous(expand = c(0, 0), 
                     limits=c(1994, 2022), 
                     breaks = seq(1994, 2022,4)) + 
   scale_y_continuous(expand = c(0,0), 
                     limits=c(345, 415), 
                     breaks = seq(350, 415, 10)) 
```

CH4 Annual Average
```{r}
#Plotting CH4 Data
CH4_avg <- ggplot(BigDays.sfdfT, 
                  aes(x=Year, y = CH4_1year))+
 
  #Line Graph
   geom_line(stat="identity",
             color = "purple3",
             linewidth = 1)+
  
  #Formatting Plot
   theme_bw()+
   theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
   ylab(expression("CH"[4]* "(ppb)"))+
   scale_x_continuous(expand=c(0,0), 
                      limits=c(1994, 2022), 
                      breaks=seq(1994,2022,4))+
   scale_y_continuous(expand=c(0,0), 
                      limits=c(1720,1880), 
                      breaks=seq(1720,1880, 20))
```

O3 Annual Average
```{r}
#Plotting O3 Data
O3_avg<-ggplot(BigDays.sfdfT,
               aes(x=Year, y=O3_1year))+

  #Line Graph
   geom_line(stat="identity",
             color = "goldenrod3",
             linewidth = 1)+
  
  #Formatting Plot
   theme_bw()+
   theme(axis.text.x=element_text(angle=45, hjust = 1))+
  
  #Formatting axes
   ylab(expression("O"[3]* "(DU)"))+
   scale_x_continuous(expand=c(0,0), 
                      limits=c(1994, 2022), 
                      breaks=seq(1994,2022,4))+
   scale_y_continuous(expand=c(0,0), 
                      limits=c(90,175), 
                      breaks=seq(90,175, 20))
```

AGGI Annual Average
```{r}
#Plotting AGGI Data
AGGI_avg<- ggplot(BigDays.sfdfT,
                  aes(x=Year, y=AGGI_1year))+
  
  #Line Graph
   geom_line(stat="identity", 
             color = "green4",
             linewidth = 1)+
  
  #Formatting plot
   theme_bw()+
   theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
   ylab("AGGI")+
   xlab("Year")+
   scale_x_continuous(expand=c(0,0), 
                      limits=c(1994, 2022), 
                      breaks=seq(1994,2022,4))+
   scale_y_continuous(expand=c(0,0), 
                      limits=c(0.5,2),
                      breaks=seq(0.5,2,0.2))
```

4x4 Grid Annual Averages
```{r}
grid.arrange(CO2_avg, CH4_avg, O3_avg, AGGI_avg, nrow=2,ncol=2, top ="Annual Averages of Greenhouse Gas Emissions")
```
  
############################
## 10-Year  Change in GHG ##
############################

CO2 10-year Averages
```{r}
#Plotting CO2 Data
CO2_10 <-ggplot(BigDays.sfdfT, 
                aes(x=Year, y=CO2_10year)) +

  #Line Graph
  geom_line(stat="identity", 
            color = "dodgerblue3",
            linewidth = 1)+
  
  #Formatting Plot
  theme_bw() +
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting axes
  xlab("Year") +
  ylab(expression("CO"[2]*"(ppm)"))+
  scale_x_continuous(expand = c(0, 0), 
                     limits=c(1994, 2022), 
                     breaks = seq(1994, 2022, 10)) + 
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(345, 415), 
                     breaks = seq(350, 415, 10)) 
```

CH4 10 year Averages
```{r}
#Plotting CH4 Data
CH4_10<-ggplot(BigDays.sfdfT, 
               aes(x=Year, y=CH4_10year)) +
 
  #Line Graph
  geom_line(stat="identity",
            color="purple3",
            linewidth=1 )+
  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  xlab("Year")+
  ylab(expression("CH"[4]* "(ppb)"))+
  scale_x_continuous(expand=c(0,0), 
                     limits=c(1994, 2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand=c(0,0), 
                     limits=c(1720,1880), 
                     breaks=seq(1720,1880, 20))
```

O3 10-year Averages
```{r}
#Plotting O3 Data
O3_10<-ggplot(BigDays.sfdfT, 
              aes(x=Year, y=O3_10year)) +
  
  #Line Graph
  geom_line(stat="identity", 
            color="goldenrod3",
            linewidth=1 )+
  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  xlab("Year")+
  ylab(expression("O"[3]*"(DU)"))+
  scale_x_continuous(expand=c(0,0), 
                     limits=c(1994, 2022),
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand=c(0,0), 
                     limits=c(90,150), 
                     breaks=seq(90,150, 10))
```

AGGI 10-year Averages
```{r}
#Plotting AGGI Data
AGGI_10<-ggplot(BigDays.sfdfT, 
                aes(x=Year, y=AGGI_10year)) +
  
  #Line Graph
  geom_line(stat="identity", 
            color="green4",
            linewidth=1 )+
  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  xlab("Year")+
  ylab("AGGI")+
  scale_x_continuous(expand=c(0,0), 
                     limits=c(1994, 2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand=c(0,0), 
                     limits=c(0.5,2),
                     breaks=seq(0.5,2,0.2))
```

```{r}
grid.arrange(CO2_10, CH4_10, O3_10, AGGI_10, nrow=2, top ="10-Year Averages of Greenhouse Gas Emissions")
```

############################
## Cor. Matrix GHG & Out. ##
############################

**Annual Correlation Matrix**
```{r}
AnnualYearCor <- BigDays.sfdfT%>%

  #Selecting Variables
  dplyr::select(nT, GroupDayCas,GroupDayFat,
                CO2_1year,
                CH4_1year, 
                O3_1year,
                AGGI_1year)

#Formatting Column names
colnames(AnnualYearCor) = c("Tot.Torn.","Tot.Cas.","Tot.Fat.", "CO2", "CH4", "O3", "AGGI")

#creating data frame 
AnnualYearCor <- as.data.frame(AnnualYearCor)
AnnualYearCor <- AnnualYearCor[1:7]

#running correlation test on variables
cordat <- cor(AnnualYearCor)

#formatting matrix
corrplot(cordat, method ="number", type = "lower", tl.col = "black")
```

**10-Year Correlation Matrix**
```{r}
TenYearCor <- BigDays.sfdfT%>%
  
  #selecting variables
  dplyr::select(nT, GroupDayCas,GroupDayFat,
                CO2_10year,
                CH4_10year, 
                O3_10year,
                AGGI_10year)

#creating column names
colnames(TenYearCor) = c("Total Tornades","Total Casualties","Total Fatalities","CO2", "CH4", "O3", "AGGI")

#creating data frame
TenYearCor <- as.data.frame(TenYearCor)
TenYearCor <- TenYearCor[1:7]

#running correlation test
cordat <- cor(TenYearCor)

#formatting matrix
corrplot(cordat, method ="circle",type= "full", tl.col = "black")
```

############################
##Scatter CO2 & Out. Size ##
############################

```{r}
ggplot(BigDays.sfdfT, aes(x=nT, y=CO2_10year, color = GroupDayCas))+
  
  #creating scatter
  geom_point()+
  
  #formatting plot
  scale_color_gradient(low ="deeppink3", high="orange")+
  theme_bw()+
    ggtitle(expression("Outbreak Size Variation with Decadal Changes in CO"[2]*"(ppm)"))+
  
  #Formatting axes
  xlab("Outbreak Size (Total Tornadoes Per Outbreak)")+
  ylab(expression("10 Year CO"[2]*"(ppm) Average"))
```

#############################
##Annual Graphs Out. & GHG ##
#############################

**Gathering Data**
```{r}
GHG<-BigDays.sfdfT%>%
  dplyr::select(Year, CO2_1year, CH4_1year, O3_1year, AGGI_1year, 
                CO2_10year,CH4_10year, O3_10year, AGGI_10year)

Torn<-BigDays.sfdfT%>%
  group_by(Year)%>%
  summarise(Totout_yr=n(),
            T_avgyear = mean(nT),
            Tot_Cas = sum(GroupDayCas))

max(Torn$Totout_yr)
min(Torn$Totout_yr)
max(Torn$Tot_Cas)
min(Torn$Tot_Cas)
```

**1 Year Averages CO2 and Outbreak Relationship**
```{r}
CO2_1<-ggplot()+
  
  #Plotting Total # of Outbreak per year
  geom_bar(data = Torn, 
           aes(x=Year, y=Totout_yr*8), 
            stat="identity", 
            fill="orange3", 
            linewidth=1)+
  
  #Plotting CO2 1 year Average
  geom_line(data = GHG, 
            aes(x=Year, y=CO2_1year), 
            stat= "identity",
            color="dodgerblue3", 
            linewidth=1)+
  
  #Formatting plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  ylab(expression("CO"[2]*"Emissions (ppm)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,5))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 415),
                     breaks = seq(0,450, 50), 
                     sec.axis = sec_axis(~./8, name = "Total Tornado Outbreaks"))
```

**1 Year Averages CH4 and Outbreak**
```{r}
CH4_1<-ggplot()+
  
  #Plotting Total # of Outbreaks  per year
  geom_bar(data = Torn,
           aes(x=Year, y=Totout_yr*60), 
           stat = "identity",
           fill="orange3", 
           linewidth=1)+
  
  #Plotting CH4 1 year averages
  geom_line(data = GHG,
            aes(x=Year, y=CH4_1year), 
            color="purple3", 
            stat = "identity",
            linewidth=1)+
  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  ylab(expression("CH"[4]*" Emissions (ppb)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022),
                     breaks=seq(1994,2022,5))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0,3000), 
                     breaks = seq(0,3000, 500), 
                     sec.axis = sec_axis(~./60, name = "Total Tornado Outbreaks"))
```

1 Year Averages O3 and Outbreak Relationship
```{r}
O3_1<-ggplot(GHG_Out)+
  
  #Plotting Total # of outbreaks per year
  geom_bar(data = Torn, 
           aes(x=Year, y=Totout_yr/.3), 
           stat = "identity",
           fill="orange3", 
           linewidth=1)+
  
  #Plotting O3 1 year averages
  geom_line(data = GHG, 
            aes(x=Year, y=O3_1year), 
            color="goldenrod3",
            stat = "identity",
            linewidth=1)+
  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  ylab(expression("O"[3]*" Emissions (DU)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022),
                     breaks=seq(1994,2022,5))+
  scale_y_continuous(expand = c(0, 0),
                     limits=c(0,200), 
                     breaks = seq(0,200,20), 
                     sec.axis = sec_axis(~.*.3, name = "Total Tornado Outbreaks"))
```

1 Year Averages AGGI and Outbreak Relationship
```{r}
AGGI_1<-ggplot(GHG_Out)+
  
  #Plotting Total # of outbreaks per year
  geom_bar(data = Torn, 
           aes(x=Year, y=Totout_yr/30), 
           stat = "identity",
           fill="orange3", 
           linewidth=1)+
  
  #Plotting AGGI 1 year averages
  geom_line(data = GHG, 
            aes(x=Year, y=AGGI_1year),
            color="green4", 
            stat = "identity",
            linewidth=1)+
  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  ylab("AGGI")+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,5))+
  scale_y_continuous(expand = c(0,0), 
                     limits=c(0,2),
                     breaks = seq(0,2,.2), 
                     sec.axis = sec_axis(~.*30, name = "Total Tornado Outbreaks"))
```

```{r}
grid.arrange(CO2_1, CH4_1, O3_1, AGGI_1, nrow=2, top ="Annual Average Emissions & Total Outbreaks per Year")
```

###############################
## 10-Year Graphs Out. & GHG ##
###############################

**10 year averages CO2 and Tornado Outbreaks**
```{r}
CO2_10<-ggplot()+
  
  #Plotting Total # of outbreaks per year
  geom_bar(data =Torn,
           aes(x=Year, y=Totout_yr*8), 
           stat="identity", 
           fill="orange3", 
           linewidth=1)+
  
  #Plotting 10 Year average CO2
  geom_line(data = GHG,
            aes(x=Year, y=CO2_10year), 
            stat= "identity",
            color="dodgerblue3", 
            linewidth=1)+

  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  ylab(expression("CO"[2]*" Emissions (ppm)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 415), 
                     breaks = seq(0,415, 50), 
                     sec.axis = sec_axis(~./8, name = "Total Tornado Outbreaks")) 
```

**10 year averages CH4 and Tornado Outbreaks**
```{r}
CH4_10<-ggplot()+
  
  #Plotting Total # of outbreaks per year
  geom_bar(data = Torn,
           aes(x=Year, y=Totout_yr*60), 
           fill="orange3", 
           stat = "identity",
           linewidth=1)+
  
  #Plotting CH4 10 year averages
  geom_line(data = GHG,
            aes(x=Year, y= CH4_10year), 
            color="purple3", 
            stat = "identity",
            linewidth=1)+

  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  ylab(expression("CH"[4]*" Emissions (ppb)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 3000),
                     breaks = seq(0,3000, 500), 
                     sec.axis = sec_axis(~./60, name = "Total Tornado Outbreaks")) 
```

**10 year averages O3 and Tornado Outbreaks**
```{r}
O3_10<-ggplot()+
  
  #Plotting Total # of outbreaks per year
  geom_bar(data = Torn, 
           aes(x=Year, y=Totout_yr/.3), 
           fill="orange3",
           stat ="identity",
           linewidth=1)+
  
  #Plotting 10 year averages of O3
  geom_line(data=GHG,
            aes(x=Year, y=O3_10year), 
            color="goldenrod3", 
            stat = "identity",
            linewidth=1)+
  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  ylab(expression("O"[3]*" Emission (DU)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 200), 
                     breaks = seq(0,200, 20), 
                     sec.axis = sec_axis(~.*.3, name = "Total Tornado Outbreaks")) 
```

**10 year averages AGGI and Tornado Outbreaks**
```{r}
AGGI_10<-ggplot()+
  
  #Plotting Total # of outbreaks per year
  geom_bar(data=Torn,
           aes(x=Year, y=Totout_yr/30), 
           stat = "identity",
           fill="orange3", 
           linewidth=1)+
  
  #Plotting 10 year averages AGGI
  geom_line(data = GHG, 
            aes(x=Year, y=AGGI_10year), 
            stat = "identity",
            color="green4", 
            linewidth=1)+
  
  #Formatting Plot
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  
  #Formatting Axes
  ylab("AGGI")+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 2), 
                     breaks = seq(0,2,.2), 
                     sec.axis = sec_axis(~.*30, name = "Total Tornado Outbreaks")) 
```

```{r}
grid.arrange(CO2_10, CH4_10, O3_10, AGGI_10, nrow=2, top ="Decadal Average Emissions & Total Outbreaks per Year")
```

#################################
## Annual Change in Cas. & GHG ##
################################

**1 year average of CO2 & Total Casualties**
```{r}
Cas1<-ggplot()+
  
  #Plotting Annual Cas
  geom_bar(data = Torn,
           aes(x=Year, y=Tot_Cas/15), 
           stat="identity",
           fill="deeppink3", 
           linewidth=1)+
  
  #Plotting Annual CO2
  geom_line(data = GHG, 
            aes(x=Year, y=CO2_1year), 
            stat= "identity",
            color="dodgerblue3", 
            linewidth=1)+
  
  
  #Formatting Graph
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  ylab(expression("CO"[2]*" Emissions (ppm)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,5))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 415),
                     breaks = seq(0,415, 50), 
                     sec.axis = sec_axis(~.*15, name = "Total Casualties"))
```

**1 Year Averages CH4 and Total Casualties**
```{r}
Cas2<-ggplot()+
  
  #Plotting Cas.
  geom_bar(data = Torn, 
           aes(x=Year, y=Tot_Cas/2), 
           stat="identity", 
           fill="deeppink3",
           linewidth=1)+
  
  #Plotting CH4 Emissions
  geom_line(data = GHG, 
            aes(x=Year, y=CH4_1year), 
            stat= "identity",
            color="purple3", 
            linewidth=1)+
  
  #Formatting Graph
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  ylab(expression("CH"[4]*" Emissions (ppb)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,5))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0,3000), 
                     breaks = seq(0,3000, 500), 
                     sec.axis = sec_axis(~.*2, name = "Total Casualties"))
```

**1 Year Averages O3 and Total *Casualties**
```{r}
Cas3<-ggplot()+
  
  #Plotting Cas
  geom_bar(data = Torn, 
           aes(x=Year, y=Tot_Cas/30), 
           stat="identity", 
           fill="deeppink3",
           linewidth=1)+
  
  #Plotting O3
  geom_line(data = GHG,
            aes(x=Year, y=O3_1year),
            stat= "identity",
            color="darkorange3", 
            linewidth=1)+
  
  #Formatting Graph
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  ylab(expression("O"[3]*" Emissions (DU)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,5))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0,200), 
                     breaks = seq(0,200,20), 
                     sec.axis = sec_axis(~.*30, name = "Total Casualties"))
```

**1 Year Averages AGGI and Total Casualties**
```{r}
Cas4<-ggplot()+
  
  #Plotting Cas
  geom_bar(data = Torn, 
           aes(x=Year, y=Tot_Cas/3000), 
           stat="identity", 
           fill="deeppink3",
           linewidth=1)+
  
  #Plotting AGGI
  geom_line(data=GHG,
            aes(x=Year, y=AGGI_1year),
            stat= "identity",
            color="green4", 
            linewidth=1)+
  
  #Formatting Graph
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  ylab("AGGI")+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,5))+
  scale_y_continuous(expand = c(0,0), 
                     limits=c(0,2), 
                     breaks = seq(0,2,.2), 
                     sec.axis = sec_axis(~.*3000, name = "Total Casualties"))
```

```{r}
grid.arrange(Cas1, Cas2, Cas3, Cas4, nrow=2, top ="Annual Average Emissions & Total Outbreaks Casualties per Year")
```

#################################
##Decadal Change in Cas. & GHG ##
################################

**10 year averages CO2 and Total Casualties**
```{r}
Cas10<-ggplot()+
  
  #plotting Cas
  geom_bar(data = Torn, 
           aes(x=Year, y=Tot_Cas/15), 
           stat="identity", 
           fill="deeppink3",
           linewidth=1)+
  
  #plotting CO2
  geom_line(data = GHG,
            aes(x=Year, y=CO2_10year), 
            stat= "identity",
            color="dodgerblue3", 
            linewidth=1)+
 
  #Formatting Graph
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  ylab(expression("CO"[2]*" Emissions (ppm)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022),
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 415), 
                     breaks = seq(0,415, 50), 
                     sec.axis = sec_axis(~.*15, name = "Total Casualties")) 
```

**10 year averages CH4 and Total Casualties**
```{r}
Cas20<-ggplot()+
  
   #plotting Cas
  geom_bar(data = Torn, 
           aes(x=Year, y=Tot_Cas/2), 
           stat="identity", 
           fill="deeppink3", 
           linewidth=1)+
  
  #plotting CH4
  geom_line(data = GHG, 
            aes(x=Year, y=CH4_10year), 
            stat= "identity",
            color="purple3", 
            linewidth=1)+
  
  #Formatting Graph
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  ylab(expression("CH"[4]*" Emissions (ppb)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 3000), 
                     breaks = seq(0,3000, 500), 
                     sec.axis = sec_axis(~.*2, name = "Total Casualties")) 
```

**10 year averages O3 and Tornado Casualties**
```{r}
Cas30<-ggplot()+
    
  #plotting Cas
  geom_bar(data = Torn, 
           aes(x=Year, y=Tot_Cas/30),
           stat="identity", 
           fill="deeppink3",
           linewidth=1)+
  
  #plotting O3
  geom_line(data = GHG, 
            aes(x=Year, y=O3_10year), 
            stat= "identity",
            color="darkorange3", 
            linewidth=1)+
  
  #formatting graph
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  ylab(expression("O"[3]*" Emission (DU)"))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 200),
                     breaks = seq(0,200, 20), 
                     sec.axis = sec_axis(~.*30, name = "Total Casualties")) 
```

**10 year averages AGGI and Total Casualties**
```{r}
Cas40<-ggplot()+
  
  #plotting cas
  geom_bar(data = Torn, 
           aes(x=Year, y=Tot_Cas/3000), 
           stat="identity", 
           fill="deeppink3",
           linewidth=1)+
  
  #plotting AGGI
  geom_line(data =GHG, 
            aes(x=Year, y=AGGI_10year),
            stat= "identity",
            color="green4",
            linewidth=1)+
  
  #formatting graph
  theme_bw()+
  ylab("AGGI")+
  theme(axis.text.x=element_text(angle=45, hjust=1))+
  scale_x_continuous(expand = c(0,0),
                     limits=c(1994,2022), 
                     breaks=seq(1994,2022,10))+
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(0, 2), 
                     breaks = seq(0,2,.2), 
                     sec.axis = sec_axis(~.*3000, name = "Total Casualties"))
```

```{r}
grid.arrange(Cas10, Cas20, Cas30, Cas40, nrow=2, top ="Decadal Average Emissions & Total Outbreaks Casualties per Year")
```
