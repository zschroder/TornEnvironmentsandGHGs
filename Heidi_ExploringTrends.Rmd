---
title: "Heidi_ExploringTrends"
author: "Heidi Erfourth and Zoe Schroder"
date: "2023-07-25"
output: html_document
---

“Exploring trends in tornado outbreak environments and greenhouse gas concentrations” 

`Pursue publication:` International Journal of Climatology
                      https://mc.manuscriptcentral.com/joc 

**Make sure to follow the Author Resources for publication in the Journal. This includes page formatting, section headers, figure format, table format, figure/table location in manuscript, etc.**

```{r}
# Do not need to do these everytime. Once installed on your computer you are finished. 
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("tidyverse")
#install.packages("tmap")
#install.packages("devtools")
#devtools::install_github("ropensci/USAboundaries")
#devtools::install_github("ropensci/USAboundariesData")
#install.packages("gridExtra")
#install.packages("colorspace")
```

```{r}
library("dplyr")
library("ggplot2")
library("tmap")
library("USAboundaries")
library("sf")
library("gridExtra")
library("colorspace")
```

DATA & METHODS
Tornado Clusters 
  Setup Data to produce a clustering with Space-Time Distances

  Needs (numbers for table): 
  1. Number of Days
  2. Number of Groups
  3. Number of Tornadoes
  4. Number of Casualties

Cluster: >= 10 tornadoes 
```{r}
BigDays.sfdfT[,-80]%>%
  group_by(cDate)%>%
  filter(nT>=10)

```
  
  Create a figure (Map) with multiple clusters on a single day
  
  Things that need to be accomplished with said figure
  - creating clustering
  - creating a line around the clustering area

Greenhouse Gas Emissions Data
  Value Selection for each Lag (Table Values)
  Needs:
  Average Emissions per year for CO2, CH4, SF6, N2O, and O3

```{r}
#need to read in the data for the excel file
AnnGHG <- read.csv("AnnualAverages_GHG.csv")

#validating that data looks correct and is the right dimensions
# dim(AnnGHG)
# str(AnnGHG)
```

*Here is the code to rename a column in R: * Fixing the typo in the excel file zero to O
```{r}
colnames(AnnGHG)[colnames(AnnGHG) == "N20_ppb"] = "N2O_ppb"
```

Calculating the Average Emissions per Year (for Table)
```{r}
#Calculating CO2 annual average
CO2_Average <- mean(AnnGHG$CO2_ppm)
print(CO2_Average)

#Calculating CH4 annual average 
CH4_Average <- mean(AnnGHG$CH4_ppb, na.rm =TRUE)#it would give me NA if I did not use the na.rm function
print(CH4_Average)

#Calculating SF6 annual Average
SF6_Average <- mean(AnnGHG$SF6_ppt, na.rm = TRUE)
print(SF6_Average)

#Calculating N20 annual average
N2O_Average <- mean(AnnGHG$N2O_ppb, na.rm = TRUE)
print(N2O_Average)

#Calculating O3 annual Average
O3_Average <- mean(AnnGHG$O3_DU, na.rm=TRUE)
print(O3_Average)

```

RESULTS
Spatial Distribution of Tornado Outbreaks in Contiguous US 
  
Needs:
- Map of US with compass and scale
- Plotting Outbreaks (NOT individual Tornadoes)

```{r}
#Reading in T-Outbreaks Data
load("TornadoOutbreaks.RData")
#dim(BigDays.sfdfT)
```
NOTE: These are only for the years 1994 to 2022. Moving forward, you will only use CO2, CH4, O3, and AGGI. N2O and SF6 are excluded because the data does not extend back to 1994. 

```{r}
#getting State Borders
sts <- state.name[!state.name %in% c("Alaska", "Hawaii")] #Removes AK and HI from list of states
stateBorders <- us_states(states = sts) 

#creating data frame with the starting Latitude and Longitude of the outbreak
coordinate <- BigDays.sfdfT["Lat","Lon"]
BigDays.sf.dfT <- st_as_sf(BigDays.sfdfT)
 
#creating map with outbreak data
tm_shape(stateBorders, projection = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m   +no_defs")+
  tm_borders(col ="gray", alpha = 1)+
  tm_compass(text.size = 1, 
             lwd = 2, 
             color.dark = "gray")+
  tm_scale_bar(width = .3, 
               text.size = 0.8, 
               lwd = 1.75, 
               color.dark = "gray")+
  tm_layout(title="Tornado Outbreaks from 1994-2022", title.position=c("center", "top"), attr.position = c("left","bottom"), inner.margins = c(.1, .1, .1, .1))+
tm_shape(BigDays.sf.dfT, is.master = TRUE, projection = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs" )+
  tm_bubbles(size = 0.1, 
             col = "navyblue")

#The only thing I am stuck with here is why the map is shifted to the left and not centered. The West is gettin cut off. 

``` 

Annual Change in Tornado Outbreaks
Needs:
- Year
- Total count of Outbreak within that year

```{r}
#creating grouping for number of outbreaks per year
T_yr<-BigDays.sfdfT[,-80]%>% 
  group_by(Year)%>%
  summarize(T_Year = n())

#creating a line graph for T-outbreaks per year (probably won't need this one, but I did both incase we wanted to pick one or the other)
ggplot(T_yr)+
  geom_line(aes(x=Year, y=T_Year), color="plum3", linewidth=1)+
  ggtitle("Total Tornado Outbreaks Per Year")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Year")+
  ylab("Number of Tornado Outbreaks per Year")+
  scale_x_continuous(expand = c(0,0),limits=c(1994,2022), breaks=seq(1994,2022,2))+
  scale_y_continuous(expand = c(0,0),limits=c(20,50),  breaks=seq(20,50,5))

#creating a bar graph with regression line for T-Outbreaks per year
ggplot(T_yr, aes(x=Year, y=T_Year))+
  geom_bar(stat="identity",position = "stack",  fill="plum3", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom="smooth", color="black", linewidth=1.5)+
  ggtitle("Total Outbreaks Per Year")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Year")+
  ylab("Number of Tornado Outbreaks")+
  scale_x_continuous(expand=c(0,0), limits=c(1994,2022), breaks=c(seq(1994, 2022, 2)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,50), breaks=c(seq(0,50,5)))

```
  *slightly positive regression line, therefore outbreaks are on the rise.*

Annual Change in GHG Emissions
Needs:
-Year
-Emission Values for that Year
-Regression Line showing overall trend

*creating individual annual trend charts for CO2, CH4, O3, AGGI*
CO2 Annual Trend Analysis Chart
```{r}  
ggplot(AnnGHG, aes(x=year, y=CO2_ppm))+
  geom_bar(stat="identity",position = "stack",  fill="orange", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="black",linewidth=1.5)+
  ggtitle(bquote("Annual Average of Carbon Dioxide CO"[2]))+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Year")+
  ylab("Concenration (ppm)")+
  scale_x_continuous(expand=c(0,0), limits=c(1955,2025), breaks=c(seq(1960,2025,10)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,500), breaks=c(seq(0,500,50)))
```
  *Positive regression line, values are on the rise*
  
CH4 Annual Trend Analysis Chart
```{r}  
ggplot(AnnGHG, aes(x=year, y=CH4_ppb))+
  geom_bar(stat="identity",position="stack",  fill="pink", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom="smooth", color="black", linewidth=1.5)+
  ggtitle(bquote("Annual Average of Methane CH"[4]))+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Years Recorded")+
  ylab("CH4 (ppb)")+
  scale_x_continuous(expand=c(0,0), limits=c(1980,2025), breaks=c(seq(1980, 2025, 10)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,2000), breaks=c(seq(0,2000,100)))
```
  *Positive regression line, values are on the rise*
  
Got rid ofthe N20 and SF6 charts because their data does not go back to 1994
  
O3 Annual Trend Analysis Chart  
```{r}
#DU = Dobson Units
ggplot(AnnGHG, aes(x=year, y=O3_DU))+
  geom_bar(stat="identity",position = "stack",  fill="maroon", width=0.9)+
  stat_smooth(method = "lm", formula= y~x, geom = "smooth", color="black", linewidth=1.5)+
  ggtitle(bquote("Annual Average of Ozone O"[3]))+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Years Recorded")+
  ylab("03 (DU)")+
  scale_x_continuous(expand=c(0,0), limits=c(1975,2025), breaks=c(seq(1975, 2025, 4)))+
  scale_y_continuous(expand=c(0,0), limits=c(0, 250), breaks=c(seq(0,250, 25)))
```
  *Negative regression line, values are decrease. However, has the most variation throughout the years*
  
AGGI Annual Trend Analysis Chart
```{r}
ggplot(AnnGHG, aes(x=year, y=AGGI))+
  geom_bar(stat="identity",position = "stack",  fill="blue", width=0.9)+
  stat_smooth(method = "lm", formula = y~x, geom="smooth", color="black", linewidth=1.5)+
  ggtitle("Annual Average for Annual Greenhouse Gas Index (AGGI)")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Years Recorded")+
  ylab("AGGI")+
  scale_x_continuous(expand=c(0,0), limits=c(1975,2025), breaks=c(seq(1975, 2025, 4)))+
  scale_y_continuous(expand=c(0,0), limits=c(0,2), breaks=c(seq(0,2,0.1)))

```
 *Positive regression line, values are on the rise*

*Combining the Annual Average Charts into a 4x4 grid*
```{r}
CO2_avg <- qplot(Year, CO2_1year, data = BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="darkturquoise", linewidth=1.5)+
  theme_bw()+
  ylab("Average of CO2")
CH4_avg <- qplot(Year, CH4_1year, data = BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="plum3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of CH4")
O3_avg <-  qplot(Year, O3_1year, data = BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="pink3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of O3")
AGGI_avg<- qplot(Year, AGGI_1year, data= BigDays.sfdfT)+
  stat_smooth(method = "lm", formula = y~x, geom = "smooth", color="seagreen3", linewidth=1.5)+
  theme_bw()+
  ylab("Average of AGGI")

grid.arrange(CO2_avg, CH4_avg, O3_avg, AGGI_avg, nrow=2,ncol=2, top ="Annual Averages of Greenhouse Gas Emissions")
```
  *Slightly confused here because the regression line of O3 is positive when the regression line for the individual one was negative. The 4x4 is using the BigDays Data because I tried using the AnnGHG but it kept giving me a mapping error*

10-year averages (Table)
*The 10 year averages are already calculated for you. They are in the BigDays.sfdfT file found in the TornadoOutbreaks.RData*
**The avg for 1994 is 1984 - 1994 not inclusive. Meaning it includes the data for years January 1984 through December 1993.**

Need to get the the 10 year values for the 90s, 00s, 10s, and 20s for the table
*I don't think I need the charts below*

Grouping CO2 10 averages
```{r}
#First: Get the 10-year average value for each year 1994 - 2022

#CO2 10 year averages
CO2 <- BigDays.sfdfT[,-80] %>%
  group_by(Year) %>%
  summarize(CO2_10yr = max(CO2_10year))
```

CO2 10-year averages trend
```{r}
#Second: Make the plot!
ggplot(CO2) +
  geom_line(aes(x = Year, y = CO2_10yr), 
            color = "red",
            linewidth = 1)  +
  theme_bw() +
  xlab("Year") +
  ylab("10-year Average CO2 Emissions") +
  theme(axis.text = element_text(size = 12), 
        axis.text.x = element_text(angle = 45, 
                                   vjust = 1.2, 
                                   hjust = 1.2),
        axis.title = element_text(size = 14), 
        legend.text = element_text(size = 14),
        ) +
  scale_x_continuous(expand = c(0, 0), 
                     limits=c(1994, 2022), 
                     breaks = seq(1994, 2022, 2)) + 
  scale_y_continuous(expand = c(0, 0), 
                     limits=c(345, 415), 
                     breaks = seq(350, 415, 10)) 
```

Grouping CH4 10 year averages
```{r}
CH4 <- BigDays.sfdfT[,-80]%>%
  group_by(Year) %>%
  summarize(CH4_10yr = max(CH4_10year))

```

CH4 10 year averages trend
```{r}
ggplot(CH4)+
  geom_line(aes(x=Year, y= CH4_10yr), color="midnightblue",linewidth=1 )+
  theme_bw()+
  xlab("Year")+
  ylab("10-Year average CH4 Emissions [ppb]")+
  scale_x_continuous(expand=c(0,0), limits=c(1994, 2022), breaks=seq(1994,2022,2))+
  scale_y_continuous(expand=c(0,0), limits=c(1720,1880), breaks=seq(1720,1880, 20))

```

Grouping O3 10 year averages
```{r}
O3 <- BigDays.sfdfT[,-80] %>%
  group_by(Year) %>%
  summarize(O3_10yr=max(O3_10year))

```

O3 10-year averages trend
```{r}
ggplot(O3)+
  geom_line(aes(x=Year, y= O3_10yr), color="lemonchiffon4",linewidth=1 )+
  theme_bw()+
  xlab("Year")+
  ylab("10-Year average O3 Emissions [DU]")+
  scale_x_continuous(expand=c(0,0), limits=c(1994, 2022), breaks=seq(1994,2022,2))+
  scale_y_continuous(expand=c(0,0), limits=c(90,150), breaks=seq(90,150, 20))
  
```

Grouping AGGI 10 year averages
```{r}
AGGI <- BigDays.sfdfT[,-80]%>%
  group_by(Year) %>%
  summarize(AGGI_10yr=max(AGGI_10year))
```

AGGI 10-year averages trend
```{r}
ggplot(AGGI)+
  geom_line(aes(x=Year, y= AGGI_10yr), color="goldenrod1",linewidth=1 )+
  ggtitle("Ten year Average of \n Annual Greenhouse Gas Index (AGGI)")+
  theme_bw()+
  theme(plot.title=element_text(hjust=0.5))+
  xlab("Year")+
  ylab("10-Year average AGGI Emissions")+
  scale_x_continuous(expand=c(0,0), limits=c(1994, 2022), breaks=seq(1994,2022,2))+
  scale_y_continuous(expand=c(0,0), limits=c(0.5,2), breaks=seq(0.5,2,0.1))
  
```

Seasonal Change in Tornado Outbreaks

Spatial Density by Month
Needs:
-Filter data for each month
-Calculate the total number of outbreaks per month
-create a figure for each month similar to the total outbreaks map
-Comment on which ones are the most dense and where

Relationship between GHG Emission and Total Number of Outbreaks

Correlation Matrix TABLE between GHG and Total Number of Outbreaks
Needs for all four: 
-Tests for correlation
-Tests for Significance

Line Graph for total outbreaks and all four variables
Needs:
-Use data for everything from 1994 to 2022



 


